// Proudly stolen from Green, thx to Editor. - Loly
var/const/stuff = {"
Hats
Collectable SWAT helmet:/obj/item/clothing/head/collectable/swat:450
Collectable Pete hat:/obj/item/clothing/head/collectable/petehat:500
Collectable Metroid hat:/obj/item/clothing/head/collectable/metroid:600
Collectable Xeno hat:/obj/item/clothing/head/collectable/xenom:400
Collectable Top hat:/obj/item/clothing/head/collectable/tophat:400
Collectable Paper hat:/obj/item/clothing/head/collectable/paper:200
Collectable Captain hat:/obj/item/clothing/head/collectable/captain:300
Collectable Police hat:/obj/item/clothing/head/collectable/police:250
Collectable Beret:/obj/item/clothing/head/collectable/beret:200
Collectable Welding helmet:/obj/item/clothing/head/collectable/welding:300
Collectable Slime hat:/obj/item/clothing/head/collectable/slime:300
Collectable Private hat:/obj/item/clothing/head/collectable/pirate:200
Collectable Wizard hat:/obj/item/clothing/head/collectable/wizard:300
Collectable Rabbit Ears:/obj/item/clothing/head/collectable/rabbitears:150
Collectable Kitty Ears:/obj/item/clothing/head/collectable/kitty:150
Kitty Ears:/obj/item/clothing/head/kitty:100
Ushanka:/obj/item/clothing/head/ushanka:300
Candyman's hat:/obj/item/clothing/head/billydonka:250
Powdered Wig:/obj/item/clothing/head/powdered_wig:150
Beanie hat:/obj/item/clothing/head/beanie:100
Redcoat hat:/obj/item/clothing/head/redcoat:150
Mailman hat:/obj/item/clothing/head/mailman:100
Hastur hood:/obj/item/clothing/head/hasturhood:250
Cueball hat:/obj/item/clothing/head/cueball:300
Cardbord helmet:/obj/item/clothing/head/cardborg:50
Justice hat:/obj/item/clothing/head/justice:100
Flat cap:/obj/item/clothing/head/flatcap:100
Pirate hat:/obj/item/clothing/head/pirate:150
Pirate bandana:/obj/item/clothing/head/bandana:150
Bowler hat:/obj/item/clothing/head/bowler:200
Witch Wig:/obj/item/clothing/head/witchwig:150
Chicken hat:/obj/item/clothing/head/chicken:50
Bear Pelt hat:/obj/item/clothing/head/bearpelt:200
Fedora hat:/obj/item/clothing/head/fedora:200
Maid hat:/obj/item/clothing/head/maidbow:100
Sombrero:/obj/item/clothing/head/sombrero:150
Green Sombrero:/obj/item/clothing/head/sombrero/green:150

Personal Stuff
Eye patch:/obj/item/clothing/glasses/eyepatch:200
Cane:/obj/item/weapon/cane:200
Zippo:/obj/item/weapon/lighter/zippo:200
Cigarette packet:/obj/item/weapon/storage/fancy/cigarettes:20
DromedaryCo packet:/obj/item/weapon/storage/fancy/cigarettes/dromedaryco:50
Premium Havanian Cigar:/obj/item/clothing/mask/cigarette/cigar/havana:200
Electronic Cigarette:/obj/item/clothing/mask/fluff/electriccig:100
Beer bottle:/obj/item/weapon/reagent_containers/food/drinks/beer:80
Captain flask:/obj/item/weapon/reagent_containers/food/drinks/flask:300
pAI card:/obj/item/device/paicard:300

Costume sets
Chicken Set:/obj/effect/landmark/costume/chicken:400
Gladiator Set:/obj/effect/landmark/costume/gladiator:700
Mad Scientist Set:/obj/effect/landmark/costume/madscientist:1000
El Presidente Set:/obj/effect/landmark/costume/elpresidente:1100
Nyan Girl Set:/obj/effect/landmark/costume/nyangirl:600
Maid Set:/obj/effect/landmark/costume/maid:650
Butler Set:/obj/effect/landmark/costume/butler:700
Scratch Set:/obj/effect/landmark/costume/scratch:750
Highladner Set:/obj/effect/landmark/costume/highlander:500
Prig Set:/obj/effect/landmark/costume/prig:550
Plague Doctor Set:/obj/effect/landmark/costume/plaguedoctor: 1000
Night Owl Set:/obj/effect/landmark/costume/nightowl:750
Waiter Set:/obj/effect/landmark/costume/waiter:500
Pirate Set:/obj/effect/landmark/costume/pirate:700
Commie Set:/obj/effect/landmark/costume/commie:500
Imperator Set:/obj/effect/landmark/costume/imperium_monk:600
Holiday Priest Set:/obj/effect/landmark/costume/holiday_priest:500
Marisa Wizard Set:/obj/effect/landmark/costume/marisawizard/fake:700
Cute Witch Set:/obj/effect/landmark/costume/cutewitch:700
Wizard Set:/obj/effect/landmark/costume/fakewizard:500
Sexy Clown Set:/obj/effect/landmark/costume/sexyclown:400
Sexy Mime Set:/obj/effect/landmark/costume/sexymime:400
Anon Set:/obj/effect/landmark/costume/anon:300

Shoes
Black Shoes:/obj/item/clothing/shoes/sneakers/black:100
Brown Shoes:/obj/item/clothing/shoes/sneakers/brown:100
Blue Shoes:/obj/item/clothing/shoes/sneakers/blue:100
Green Shoes:/obj/item/clothing/shoes/sneakers/green:100
Yellow Shoes:/obj/item/clothing/shoes/sneakers/yellow:100
Purple Shoes:/obj/item/clothing/shoes/sneakers/purple:100
Red Shoes:/obj/item/clothing/shoes/sneakers/red:100
White Shoes:/obj/item/clothing/shoes/sneakers/white:100
Rainbow Shoes:/obj/item/clothing/shoes/sneakers/rainbow:150
Mime Shoes:/obj/item/clothing/shoes/sneakers/mime:150
Warm Shoes:/obj/item/clothing/shoes/boots:100
Sandal:/obj/item/clothing/shoes/sandal:100
Clown Shoes:/obj/item/clothing/shoes/clown_shoes:150
Jackboots:/obj/item/clothing/shoes/jackboots:100
Cyborg Shoes:/obj/item/clothing/shoes/cyborg:150
Laceup Shoes:/obj/item/clothing/shoes/laceup:150
Roman Shoes:/obj/item/clothing/shoes/roman:200

Jumpsuits
Black Jumpsuit:/obj/item/clothing/under/color/black:100
Blue Jumpsuit:/obj/item/clothing/under/color/blue:100
Green Jumpsuit:/obj/item/clothing/under/color/green:100
Pink Jumpsuit:/obj/item/clothing/under/color/pink:100
Red Jumpsuit:/obj/item/clothing/under/color/red:100
White Jumpsuit:/obj/item/clothing/under/color/white:100
Yellow Jumpsuit:/obj/item/clothing/under/color/yellow:100
Psychodelic Jumpsuit:/obj/item/clothing/under/color/psyche:300
Aqua Jumpsuit:/obj/item/clothing/under/color/aqua:150
Purple Jumpsuit:/obj/item/clothing/under/color/purple:100
Light Purple Jumpsuit:/obj/item/clothing/under/color/lightpurple:150
Light Green Jumpsuit:/obj/item/clothing/under/color/lightgreen:150
Light Blue Jumpsuit:/obj/item/clothing/under/color/lightblue:150
Light Brown Jumpsuit:/obj/item/clothing/under/color/lightbrown:150
Yellow-green Jumpsuit:/obj/item/clothing/under/color/yellowgreen:150
Dark Blue Jumpsuit:/obj/item/clothing/under/color/darkblue:150
Light Red Jumpsuit:/obj/item/clothing/under/color/lightred:150
Dark Red Jumpsuit:/obj/item/clothing/under/color/darkred:150
Light Pink Jumpsuit:/obj/item/clothing/under/lightpink:150
Scratch Suit:/obj/item/clothing/under/scratch:150
Amish Suit:/obj/item/clothing/under/sl_suit:200
Sexy-clown Suit:/obj/item/clothing/under/sexyclown:150
Owl Suit:/obj/item/clothing/under/owl:150
Johnny Suit:/obj/item/clothing/under/johnny:300
Rainbow Suit:/obj/item/clothing/under/rainbow:300
Black suit:/obj/item/clothing/under/suit_jacket:150
Executive Suit:/obj/item/clothing/under/suit_jacket/really_black:150
Female Executive Suit:/obj/item/clothing/under/suit_jacket/female:150
Red Suit:/obj/item/clothing/under/suit_jacket/red:150
Charcoal Suit:/obj/item/clothing/under/suit_jacket/charcoal:150
Burgundy Suit:/obj/item/clothing/under/suit_jacket/burgundy:200
Checkered Suit:/obj/item/clothing/under/suit_jacket/checkered:150
Tan Suit:/obj/item/clothing/under/suit_jacket/tan:150
Black Skirt:/obj/item/clothing/under/blackskirt:150
Schoolgirl Suit:/obj/item/clothing/under/schoolgirl:150
Pirate Suit:/obj/item/clothing/under/pirate:200
Soviet Suit:/obj/item/clothing/under/soviet:200
Redcoat Suit:/obj/item/clothing/under/redcoat:150
Kilt:/obj/item/clothing/under/kilt:150
Sexymime Suit:/obj/item/clothing/under/sexymime:150
Gladiator Suit:/obj/item/clothing/under/gladiator:150
Sundress:/obj/item/clothing/under/sundress:150
Black Tango Dress:/obj/item/clothing/under/blacktango:150
Maid Suit:/obj/item/clothing/under/maid:150
Jeans:/obj/item/clothing/under/jeans:150
Track Pants:/obj/item/clothing/under/trackpants:150
Khaki Pants:/obj/item/clothing/under/khaki:200
Camo Pants:/obj/item/clothing/under/camo:150
Kamina Pants:/obj/item/clothing/under/kamina:300

Gloves
Orange Gloves:/obj/item/clothing/gloves/orange:100
Red Gloves:/obj/item/clothing/gloves/red:100
Rainbow Gloves:/obj/item/clothing/gloves/rainbow:150
Blue Gloves:/obj/item/clothing/gloves/blue:100
Purple Gloves:/obj/item/clothing/gloves/purple:100
Green Gloves:/obj/item/clothing/gloves/green:100
Grey Gloves:/obj/item/clothing/gloves/grey:100
Light Brown Gloves:/obj/item/clothing/gloves/light_brown:100
Brown Gloves:/obj/item/clothing/gloves/brown:100
Cyborg Gloves:/obj/item/clothing/gloves/cyborg:150
Fingerless Gloves:/obj/item/clothing/gloves/fingerless:150

Coats
Pirate Coat:/obj/item/clothing/suit/pirate:300
Nazi Coat:/obj/item/clothing/suit/greatcoat:1488
Johnny Coat:/obj/item/clothing/suit/johnny_coat:300
Judge Robe:/obj/item/clothing/suit/judgerobe:250
Cabanela Suit:/obj/item/clothing/suit/cabanelasuit:300
Monkey Suit:/obj/item/clothing/suit/monkeysuit:350
Cardborg Suit:/obj/item/clothing/suit/cardborg:100
Poncho:/obj/item/clothing/suit/poncho:250
Worn Shirt:/obj/item/clothing/suit/ianshirt:200
Gamer Shirt:/obj/item/clothing/suit/nerdshirt:200
Xeno Suit:/obj/item/clothing/suit/xenos:500
Candyman Vest:/obj/item/clothing/suit/billydonka:300

Bedsheets
Blue Bedsheet:/obj/item/weapon/bedsheet/blue:200
Green Bedsheet:/obj/item/weapon/bedsheet/green:200
Orange Bedsheet:/obj/item/weapon/bedsheet/orange:200
Purple Bedsheet:/obj/item/weapon/bedsheet/purple:200
Rainbow Bedsheet:/obj/item/weapon/bedsheet/rainbow:250
Red Bedsheet:/obj/item/weapon/bedsheet/red:200
Yellow Bedsheet:/obj/item/weapon/bedsheet/yellow:200
Mime Bedsheet:/obj/item/weapon/bedsheet/mime:200
Clown Bedsheet:/obj/item/weapon/bedsheet/clown:200
Captain Bedsheet:/obj/item/weapon/bedsheet/captain:500
RD Bedsheet:/obj/item/weapon/bedsheet/rd:400
Medical Bedsheet:/obj/item/weapon/bedsheet/medical:200
CMO Bedsheet:/obj/item/weapon/bedsheet/cmo:400
HoS Bedsheet:/obj/item/weapon/bedsheet/hos:400
HoP Bedsheet:/obj/item/weapon/bedsheet/hop:400
CE Bedsheet:/obj/item/weapon/bedsheet/ce:400
Brown Bedsheet:/obj/item/weapon/bedsheet/brown:200
Nar-Sie Bedsheet:/obj/item/weapon/bedsheet/cult:600
Wizard's Bedsheet:/obj/item/weapon/bedsheet/wiz:600

Toys
Rubber Duck:/obj/item/weapon/bikehorn/rubberducky:500
Champion Belt:/obj/item/weapon/storage/belt/champion:400
Cigar Case: /obj/item/weapon/storage/fancy/cigarcase:400

Special Stuff
Santabag:/obj/item/weapon/storage/backpack/santabag:4000
Gar Sunglasses:/obj/item/clothing/glasses/sunglasses/gar:500
"}


var/list/datum/donator_prize/prizes = list()
var/list/datum/donator/donators = list()

/datum/donator
	var/ownerkey
	var/money = 0
	var/maxmoney = 0
	var/allowed_num_items = 10

	New(ckey, money)
		..()
		ownerkey = ckey
		src.money = money
		maxmoney = money
		donators[ckey] = src

	proc/show()
		var/dat = "<title>Loly Secret Shop:</title>"
		dat += "You have [money] / [maxmoney]<br>"
		dat += "You can spawn [ allowed_num_items ? allowed_num_items : "no" ] more items.<br><br>"

		if (allowed_num_items)
			if (!prizes.len)
				build_prizes_list()

			var/cur_cat = "None"

			for (var/i = 1, i<=prizes.len, i++)
				var/datum/donator_prize/prize = prizes[i]
				var/cat_name = prize.category
				if (cur_cat != cat_name)
					dat += "<hr><b>[cat_name]</b><br>"
				cur_cat = cat_name
				dat += "<a href='?src=\ref[src];itemid=[i]'>[prize.item_name] : [prize.cost]</a><br>"
		usr << browse(dat, "window=donatorpanel;size=250x400")

	Topic(href, href_list)
		var/id = text2num(href_list["itemid"])
		var/datum/donator_prize/prize = prizes[id]

		var/name = prize.item_name
		var/cost = prize.cost
		var/path = prize.path_to
		var/mob/living/carbon/human/user = usr.client.mob

		var/list/slots = list (
			"backpack" = slot_in_backpack,
			"left pocket" = slot_l_store,
			"right pocket" = slot_r_store,
			"left hand" = slot_l_hand,
			"right hand" = slot_r_hand,
		)

		if(cost > money)
			usr << "\red You don't have enough funds."
			return 0

		if(!allowed_num_items)
			usr << "\red You have reached maximum amount of spawned items."
			return 0

		if(!user)
			user << "\red You must be a human to use this."
			return 0

		if(!ispath(path))
			return 0

		if(user.stat) return 0

		var/obj/spawned = new path

		var/where = user.equip_in_one_of_slots(spawned, slots, del_on_fail=0)

		if (!where)
			spawned.loc = user.loc
			usr << "\blue Your [name] has been spawned!"
		else
			usr << "\blue Your [name] has been spawned in your [where]!"

		money -= cost
		allowed_num_items--

		show()

/datum/donator_prize
	var/item_name = "Nothing"
	var/path_to = /datum/donator_prize
	var/cost = 0
	var/category = "Debug"

proc/load_donator(ckey)

	var/DBConnection/dbcon2 = new()
	dbcon2.Connect("dbi:mysql:forum2:[sqladdress]:[sqlport]","[sqlfdbklogin]","[sqlfdbkpass]")
	if(!dbcon2.IsConnected())
		log_admin("Failed to load donatorlist. Error: [dbcon2.ErrorMsg()]")
		return
	var/DBQuery/query = dbcon.NewQuery("SELECT sum FROM forum2.Z_donators WHERE byond='[ckey]'")
	query.Execute()

	if (query.item.len)
		var/money = round(query.item[1])
		new /datum/donator(ckey, money)
		return 1
	else
		return 0

proc/build_prizes_list()
	var/list/strings = text2list ( stuff, "\n" )
	var/cur_cat = "Miscellaneous"
	for (var/string in strings)
		if (string) //It's not a delimiter between
			var/list/item_info = text2list ( string, ":" )
			if (item_info.len==3)
				var/datum/donator_prize/prize = new
				prize.item_name = item_info[1]
				prize.path_to = text2path(item_info[2])
				prize.cost = text2num(item_info[3])
				prize.category = cur_cat
				prizes += prize
			else
				cur_cat = item_info[1]


/client/verb/cmd_donator_panel()
	set name = "Donator panel"
	set category = "OOC"

	if(!ticker || ticker.current_state < 3)
		alert("Please wait until game setting up!")
		return

	if (!donators[ckey]) //It doesn't exist yet
		if (load_donator(ckey))
			var/datum/donator/D = donators[ckey]
			D.show()
		else
			usr << browse ("<b>You have not donated or the database is inaccessible.</b>", "window=donatorpanel")
	else
		var/datum/donator/D = donators[ckey]
		D.show()

//SPECIAL ITEMS
/obj/item/weapon/reagent_containers/food/drinks/drinkingglass/threemileisland
	New()
		..()
		reagents.add_reagent("threemileisland", 50)
		on_reagent_change()